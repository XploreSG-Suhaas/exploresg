# Ingress Controller for XploreSG Local Development
# Routes external traffic to internal services

# Note: Requires an ingress controller (nginx-ingress) to be installed in minikube
# Enable with: minikube addons enable ingress

apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: xploresg-ingress
  namespace: xploresg-dev
  labels:
    app.kubernetes.io/name: xploresg-ingress
  annotations:
    kubernetes.io/ingress.class: "nginx"
    nginx.ingress.kubernetes.io/rewrite-target: /
    # Enable CORS for development
    nginx.ingress.kubernetes.io/enable-cors: "true"
    nginx.ingress.kubernetes.io/cors-allow-origin: "*"
    nginx.ingress.kubernetes.io/cors-allow-methods: "GET, POST, PUT, DELETE, OPTIONS"
    nginx.ingress.kubernetes.io/cors-allow-headers: "DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range,Authorization"
spec:
  rules:
    # Frontend application
    - host: xploresg.local
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: frontend-service
                port:
                  number: 80

    # API endpoints
    - host: api.xploresg.local
      http:
        paths:
          # User service API
          - path: /users
            pathType: Prefix
            backend:
              service:
                name: user-service
                port:
                  number: 3001
          - path: /auth
            pathType: Prefix
            backend:
              service:
                name: user-service
                port:
                  number: 3001

          # Health check endpoint (accessible via API subdomain)
          - path: /health
            pathType: Prefix
            backend:
              service:
                name: user-service
                port:
                  number: 3001

---
# Alternative: Simple Ingress without subdomains (if DNS setup is complex)
# apiVersion: networking.k8s.io/v1
# kind: Ingress
# metadata:
#   name: xploresg-simple-ingress
#   namespace: xploresg-dev
#   labels:
#     app.kubernetes.io/name: xploresg-simple-ingress
#   annotations:
#     kubernetes.io/ingress.class: "nginx"
#     nginx.ingress.kubernetes.io/enable-cors: "true"
#     nginx.ingress.kubernetes.io/cors-allow-origin: "*"
# spec:
#   rules:
#   - http:
#       paths:
#       # Frontend (root path)
#       - path: /
#         pathType: Prefix
#         backend:
#           service:
#             name: frontend-service
#             port:
#               number: 80
#       # API paths
#       - path: /api/users
#         pathType: Prefix
#         backend:
#           service:
#             name: user-service
#             port:
#               number: 3001
#       - path: /api/auth
#         pathType: Prefix
#         backend:
#           service:
#             name: user-service
#             port:
#               number: 3001
